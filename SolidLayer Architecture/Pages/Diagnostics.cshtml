@page
@model SolidLayer_Architecture.Pages.DiagnosticsModel
@{
    ViewData["Title"] = "System Diagnostics";
}

<h1>System Diagnostics</h1>

<div class="card mb-4">
    <div class="card-header">
        <h5>Database Connection</h5>
    </div>
    <div class="card-body">
        @if (Model.DbConnectionSuccessful)
        {
            <div class="alert alert-success">
                <i class="bi bi-check-circle"></i> Database connection successful!
            </div>
        }
        else
        {
            <div class="alert alert-danger">
                <i class="bi bi-exclamation-triangle"></i> Database connection failed!
            </div>
            <p>Error: @Model.DbConnectionError</p>
        }

        <div>
            <p><strong>Connection String:</strong> @Model.MaskedConnectionString</p>
        </div>
        
        <div class="mt-3 mb-3">
            <form method="post">
                <div class="card bg-light p-3 mb-3">
                    <h6 class="mb-3">Database Maintenance Actions:</h6>
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" asp-for="RunDatabaseFix" id="runDatabaseFix">
                        <label class="form-check-label" for="runDatabaseFix">
                            Fix database schema issues (alter column sizes to match requirements)
                        </label>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" asp-for="RunDishIdFix" id="runDishIdFix">
                        <label class="form-check-label" for="runDishIdFix">
                            Fix dish ID issues (normalize IDs to proper format)
                        </label>
                    </div>
                    <button type="submit" class="btn btn-warning">Execute Selected Actions</button>
                </div>
            </form>
        </div>
        
        @if (Model.DatabaseFixed)
        {
            <div class="alert alert-success mt-3">
                <i class="bi bi-check-circle"></i> Database schema has been fixed!
            </div>
        }
        
        @if (Model.DishIdsFixed)
        {
            <div class="alert alert-success mt-3">
                <i class="bi bi-check-circle"></i> Dish IDs have been normalized!
            </div>
        }

        @if (Model.TableStructure != null && Model.TableStructure.Count > 0)
        {
            <h5>Database Tables:</h5>
            <ul>
                @foreach (var table in Model.TableStructure)
                {
                    <li>
                        <strong>@table.Key</strong>
                        <ul>
                            @foreach (var column in table.Value)
                            {
                                <li>@column</li>
                            }
                        </ul>
                    </li>
                }
            </ul>
        }
    </div>
</div>

<div class="mt-3">
    <a asp-page="/Index" class="btn btn-primary">Back to Home</a>
    <a asp-page="/Dishes/Index" class="btn btn-success ms-2">Manage Dishes</a>
</div>
